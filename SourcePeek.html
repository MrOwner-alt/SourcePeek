<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SourcePeek+ Pro | Advanced Web Scraper</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github-dark.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/js-beautify/1.14.7/beautify-html.min.js"></script>
  <style>
    :root {
      --primary: #58a6ff;
      --primary-dark: #388bfd;
      --secondary: #f78166;
      --success: #3fb950;
      --danger: #f85149;
      --warning: #d29922;
      --dark-bg: #0d1117;
      --card-bg: #161b22;
      --border: #30363d;
      --text: #c9d1d9;
      --text-muted: #8b949e;
      --gradient-start: #1a2980;
      --gradient-end: #26d0ce;
      --light-bg: #f0f6fc;
      --light-card: #ffffff;
      --light-text: #0d1117;
      --light-border: #d0d7de;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      margin: 0;
      padding: 0;
      font-family: 'Segoe UI', system-ui, sans-serif;
      background: linear-gradient(135deg, var(--dark-bg) 0%, #0a0d12 100%);
      color: var(--text);
      min-height: 100vh;
      line-height: 1.6;
      transition: background 0.3s ease, color 0.3s ease;
    }

    body.light-mode {
      background: linear-gradient(135deg, #f0f6fc 0%, #e6edf7 100%);
      color: var(--light-text);
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }

    header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 20px 0;
      margin-bottom: 20px;
      border-bottom: 1px solid var(--border);
    }

    .light-mode header {
      border-bottom-color: var(--light-border);
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .logo-icon {
      background: linear-gradient(135deg, var(--gradient-start), var(--gradient-end));
      width: 50px;
      height: 50px;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      animation: pulse 2s infinite;
    }

    .light-mode .logo-icon {
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    .logo-icon i {
      font-size: 24px;
      color: white;
    }

    .logo-text h1 {
      font-size: 1.8rem;
      margin-bottom: 5px;
      background: linear-gradient(to right, var(--primary), var(--secondary));
      -webkit-background-clip: text;
      background-clip: text;
      -webkit-text-fill-color: transparent;
      font-weight: 700;
    }

    .light-mode .logo-text h1 {
      background: linear-gradient(to right, #1a2980, #26d0ce);
    }

    .logo-text p {
      font-size: 0.9rem;
      color: var(--text-muted);
      margin: 0;
    }

    .light-mode .logo-text p {
      color: #57606a;
    }

    .stats {
      display: flex;
      gap: 20px;
      background: var(--card-bg);
      padding: 12px 20px;
      border-radius: 10px;
      border: 1px solid var(--border);
    }

    .light-mode .stats {
      background: var(--light-card);
      border-color: var(--light-border);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
    }

    .stat-item {
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .stat-value {
      font-size: 1.2rem;
      font-weight: 700;
      color: var(--primary);
    }

    .stat-label {
      font-size: 0.8rem;
      color: var(--text-muted);
    }

    .light-mode .stat-label {
      color: #57606a;
    }

    main {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin-bottom: 30px;
    }

    @media (max-width: 900px) {
      main {
        grid-template-columns: 1fr;
      }
    }

    .card {
      background: var(--card-bg);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 25px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .light-mode .card {
      background: var(--light-card);
      border-color: var(--light-border);
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.05);
    }

    .card:hover {
      transform: translateY(-5px);
      box-shadow: 0 15px 40px rgba(0, 0, 0, 0.4);
    }

    .light-mode .card:hover {
      box-shadow: 0 15px 40px rgba(0, 0, 0, 0.1);
    }

    .card-header {
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .card-title {
      font-size: 1.4rem;
      color: var(--primary);
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .light-mode .card-title {
      color: #1a2980;
    }

    .input-group {
      display: flex;
      gap: 10px;
      margin-bottom: 15px;
    }

    input[type="text"] {
      flex: 1;
      padding: 14px;
      background-color: rgba(22, 27, 34, 0.7);
      backdrop-filter: blur(10px);
      color: #fff;
      border: 1px solid var(--border);
      border-radius: 8px;
      font-size: 1rem;
      transition: all 0.3s ease;
    }

    .light-mode input[type="text"] {
      background-color: rgba(240, 246, 252, 0.7);
      color: var(--light-text);
      border-color: var(--light-border);
    }

    input[type="text"]:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(56, 139, 253, 0.3);
    }

    .light-mode input[type="text"]:focus {
      box-shadow: 0 0 0 3px rgba(26, 41, 128, 0.2);
    }

    .btn {
      padding: 14px 20px;
      background-color: var(--primary);
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      transition: all 0.2s ease;
      font-size: 0.95rem;
    }

    .btn:hover {
      background-color: var(--primary-dark);
      transform: translateY(-2px);
    }

    .btn-success {
      background-color: var(--success);
    }

    .btn-success:hover {
      background-color: #2ea043;
    }

    .btn-danger {
      background-color: var(--danger);
    }

    .btn-danger:hover {
      background-color: #da3633;
    }

    .btn-warning {
      background-color: var(--warning);
    }

    .btn-warning:hover {
      background-color: #bb8009;
    }

    .btn-group {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 15px;
    }

    .action-buttons {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 15px;
    }

    .btn-sm {
      padding: 10px 15px;
      font-size: 0.9rem;
    }

    .btn-outline {
      background: transparent;
      border: 1px solid var(--border);
      color: var(--text);
    }

    .light-mode .btn-outline {
      border-color: var(--light-border);
      color: var(--light-text);
    }

    .btn-outline:hover {
      background: rgba(255, 255, 255, 0.05);
      transform: none;
    }

    .light-mode .btn-outline:hover {
      background: rgba(0, 0, 0, 0.03);
    }

    #output {
      width: 100%;
      height: 500px;
      margin-top: 20px;
      padding: 15px;
      background-color: rgba(22, 27, 34, 0.7);
      backdrop-filter: blur(10px);
      color: var(--text);
      border: 1px solid var(--border);
      border-radius: 8px;
      resize: vertical;
      font-family: 'Fira Code', monospace;
      font-size: 0.9rem;
      line-height: 1.6;
      white-space: pre;
      overflow: auto;
      display: none;
    }

    .light-mode #output {
      background-color: rgba(240, 246, 252, 0.7);
      color: var(--light-text);
      border-color: var(--light-border);
    }

    .error-message {
      color: var(--danger);
      background-color: rgba(30, 32, 39, 0.8);
      padding: 15px;
      border-radius: 8px;
      margin-top: 15px;
      border-left: 3px solid var(--danger);
      display: none;
    }

    .light-mode .error-message {
      background-color: rgba(255, 235, 233, 0.8);
      color: #cf222e;
    }

    .disclaimer {
      font-size: 0.85rem;
      color: var(--text-muted);
      margin-top: 30px;
      padding: 20px;
      background-color: rgba(22, 27, 34, 0.7);
      backdrop-filter: blur(10px);
      border-radius: 8px;
      border-left: 3px solid var(--danger);
    }

    .light-mode .disclaimer {
      background-color: rgba(255, 235, 233, 0.8);
      color: #57606a;
      border-left-color: #cf222e;
    }

    .disclaimer strong {
      color: var(--danger);
    }

    .light-mode .disclaimer strong {
      color: #cf222e;
    }

    .status {
      margin: 15px 0;
      padding: 12px 15px;
      background: rgba(22, 27, 34, 0.7);
      backdrop-filter: blur(10px);
      border-radius: 8px;
      border-left: 3px solid var(--primary);
      display: none;
    }

    .light-mode .status {
      background: rgba(240, 246, 252, 0.7);
      border-left-color: #1a2980;
    }

    .proxy-status {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 15px;
    }

    .proxy-tag {
      padding: 6px 12px;
      background: rgba(56, 139, 253, 0.15);
      border-radius: 20px;
      font-size: 0.8rem;
      display: flex;
      align-items: center;
      gap: 5px;
    }

    .light-mode .proxy-tag {
      background: rgba(26, 41, 128, 0.1);
    }

    .proxy-tag.active {
      background: rgba(63, 185, 80, 0.2);
      color: var(--success);
    }

    .light-mode .proxy-tag.active {
      background: rgba(46, 160, 67, 0.15);
    }

    .proxy-tag.inactive {
      background: rgba(248, 81, 73, 0.15);
      color: var(--danger);
    }

    .light-mode .proxy-tag.inactive {
      background: rgba(207, 34, 46, 0.15);
    }

    .history-panel {
      margin-top: 20px;
      max-height: 150px;
      overflow-y: auto;
    }

    .history-item {
      padding: 10px;
      border-bottom: 1px solid var(--border);
      cursor: pointer;
      transition: background 0.2s;
      display: flex;
      justify-content: space-between;
      font-size: 0.9rem;
    }

    .light-mode .history-item {
      border-bottom-color: var(--light-border);
    }

    .history-item:hover {
      background: rgba(255, 255, 255, 0.05);
    }

    .light-mode .history-item:hover {
      background: rgba(0, 0, 0, 0.03);
    }

    .history-item .time {
      color: var(--text-muted);
      font-size: 0.8rem;
    }

    .light-mode .history-item .time {
      color: #57606a;
    }

    .loading {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 15px;
      padding: 30px;
      flex-direction: column;
      display: none;
    }

    .spinner {
      width: 50px;
      height: 50px;
      border: 5px solid rgba(56, 139, 253, 0.2);
      border-top: 5px solid var(--primary);
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    .light-mode .spinner {
      border-top-color: #1a2980;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    @keyframes pulse {
      0% { box-shadow: 0 0 0 0 rgba(56, 139, 253, 0.7); }
      70% { box-shadow: 0 0 0 12px rgba(56, 139, 253, 0); }
      100% { box-shadow: 0 0 0 0 rgba(56, 139, 253, 0); }
    }

    .tabs {
      display: flex;
      border-bottom: 1px solid var(--border);
      margin-bottom: 15px;
    }

    .light-mode .tabs {
      border-bottom-color: var(--light-border);
    }

    .tab {
      padding: 10px 20px;
      cursor: pointer;
      border-bottom: 3px solid transparent;
      transition: all 0.3s;
    }

    .tab.active {
      border-bottom: 3px solid var(--primary);
      color: var(--primary);
    }

    .light-mode .tab.active {
      color: #1a2980;
      border-bottom-color: #1a2980;
    }

    .tab-content {
      display: none;
    }

    .tab-content.active {
      display: block;
    }

    .syntax-info {
      background: rgba(56, 139, 253, 0.1);
      padding: 12px 15px;
      border-radius: 8px;
      margin-top: 15px;
      font-size: 0.9rem;
      border-left: 3px solid var(--primary);
    }

    .light-mode .syntax-info {
      background: rgba(26, 41, 128, 0.1);
      border-left-color: #1a2980;
    }

    .hljs {
      background: rgba(13, 17, 23, 0.7) !important;
      border-radius: 8px;
      padding: 20px !important;
    }

    .light-mode .hljs {
      background: rgba(240, 246, 252, 0.7) !important;
    }

    footer {
      text-align: center;
      padding: 20px;
      color: var(--text-muted);
      font-size: 0.9rem;
      border-top: 1px solid var(--border);
      margin-top: 30px;
    }

    .light-mode footer {
      color: #57606a;
      border-top-color: var(--light-border);
    }

    .key-shortcut {
      background: rgba(255, 255, 255, 0.1);
      padding: 3px 6px;
      border-radius: 4px;
      font-size: 0.8rem;
      display: inline-block;
      margin: 0 3px;
    }

    .light-mode .key-shortcut {
      background: rgba(0, 0, 0, 0.05);
    }

    /* Theme toggle */
    .theme-toggle {
      position: absolute;
      top: 30px;
      right: 30px;
      width: 60px;
      height: 30px;
      border-radius: 15px;
      background: var(--card-bg);
      border: 1px solid var(--border);
      cursor: pointer;
      display: flex;
      align-items: center;
      padding: 0 5px;
      transition: all 0.3s ease;
    }

    .light-mode .theme-toggle {
      background: var(--light-card);
      border-color: var(--light-border);
    }

    .theme-toggle-handle {
      width: 22px;
      height: 22px;
      border-radius: 50%;
      background: var(--primary);
      transition: transform 0.3s ease;
    }

    .light-mode .theme-toggle-handle {
      transform: translateX(30px);
      background: #1a2980;
    }

    /* Data extraction panel */
    .data-extraction {
      margin-top: 20px;
      display: none;
    }

    .data-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }

    .extracted-data {
      background: rgba(22, 27, 34, 0.7);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 15px;
      max-height: 300px;
      overflow-y: auto;
    }

    .light-mode .extracted-data {
      background: rgba(240, 246, 252, 0.7);
      border-color: var(--light-border);
    }

    .data-list {
      list-style: none;
      padding: 0;
    }

    .data-list li {
      padding: 8px 0;
      border-bottom: 1px solid var(--border);
    }

    .light-mode .data-list li {
      border-bottom-color: var(--light-border);
    }

    .data-list li:last-child {
      border-bottom: none;
    }

    .data-list a {
      color: var(--primary);
      text-decoration: none;
    }

    .light-mode .data-list a {
      color: #1a2980;
    }

    .data-list a:hover {
      text-decoration: underline;
    }

    /* Responsive adjustments */
    @media (max-width: 600px) {
      .input-group {
        flex-direction: column;
      }
      
      .stats {
        display: none;
      }
      
      header {
        flex-direction: column;
        gap: 15px;
        align-items: flex-start;
      }
      
      .btn-group {
        flex-direction: column;
      }
      
      .theme-toggle {
        position: relative;
        top: 0;
        right: 0;
        margin: 15px 0;
        align-self: flex-end;
      }
    }

    /* Tooltip */
    .tooltip {
      position: relative;
      display: inline-block;
    }

    .tooltip .tooltiptext {
      visibility: hidden;
      width: 140px;
      background-color: var(--card-bg);
      color: var(--text);
      text-align: center;
      border-radius: 6px;
      padding: 5px;
      position: absolute;
      z-index: 1;
      bottom: 125%;
      left: 50%;
      margin-left: -75px;
      opacity: 0;
      transition: opacity 0.3s;
      font-size: 0.8rem;
      border: 1px solid var(--border);
    }

    .light-mode .tooltip .tooltiptext {
      background-color: var(--light-card);
      color: var(--light-text);
      border-color: var(--light-border);
    }

    .tooltip:hover .tooltiptext {
      visibility: visible;
      opacity: 1;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="theme-toggle" id="themeToggle" aria-label="Toggle theme" role="button" tabindex="0">
      <div class="theme-toggle-handle"></div>
    </div>
    
    <header>
      <div class="logo">
        <div class="logo-icon">
          <i class="fas fa-code"></i>
        </div>
        <div class="logo-text">
          <h1>SourcePeek+ Pro</h1>
          <p>Advanced website source code viewer with bypass capabilities</p>
        </div>
      </div>
      <div class="stats">
        <div class="stat-item">
          <div class="stat-value" id="requestCount">0</div>
          <div class="stat-label">Requests</div>
        </div>
        <div class="stat-item">
          <div class="stat-value" id="successCount">0</div>
          <div class="stat-label">Success</div>
        </div>
        <div class="stat-item">
          <div class="stat-value" id="bypassCount">0</div>
          <div class="stat-label">Bypassed</div>
        </div>
      </div>
    </header>

    <main>
      <div class="card">
        <div class="card-header">
          <h2 class="card-title"><i class="fas fa-globe"></i> Website Source Viewer</h2>
          <div class="tooltip" tabindex="0" aria-label="Info">
            <i class="fas fa-info-circle"></i>
            <span class="tooltiptext">Enter URL and fetch source code. Use bypass for restricted sites.</span>
          </div>
        </div>
        
        <div class="input-group">
          <input id="urlInput" type="text" placeholder="Enter website URL (e.g. https://example.com)" aria-label="Website URL" autofocus />
          <button class="btn btn-success" onclick="getSource()" aria-label="Fetch Source">
            <i class="fas fa-download"></i> Fetch Source
          </button>
        </div>
        
        <div class="btn-group">
          <button class="btn btn-sm" onclick="tryBypassMethods()">
            <i class="fas fa-unlock-alt"></i> Advanced Bypass
          </button>
          <button class="btn btn-sm" onclick="extractData()">
            <i class="fas fa-filter"></i> Extract Data
          </button>
          <button class="btn btn-sm btn-warning" onclick="clearOutput()">
            <i class="fas fa-broom"></i> Clear Output
          </button>
          <button class="btn btn-sm btn-danger" onclick="checkProxies()">
            <i class="fas fa-plug"></i> Check Proxies
          </button>
        </div>
        
        <div id="status" class="status"></div>
        
        <div class="loading" id="loading">
          <div class="spinner"></div>
          <p>Fetching website source code...</p>
        </div>
        
        <div id="errorContainer" class="error-message"></div>
        
        <pre><code id="output" class="language-html"></code></pre>
        
        <div class="action-buttons">
          <button class="btn btn-outline" onclick="copySource()">
            <i class="fas fa-copy"></i> Copy Source
          </button>
          <button class="btn btn-outline" onclick="downloadSource()">
            <i class="fas fa-file-download"></i> Download
          </button>
          <button class="btn btn-outline" onclick="beautifyCode()">
            <i class="fas fa-indent"></i> Format Code
          </button>
          <button class="btn btn-outline" onclick="minifyCode()">
            <i class="fas fa-compress"></i> Minify
          </button>
        </div>
        
        <div class="data-extraction" id="dataExtraction">
          <div class="data-header">
            <h3><i class="fas fa-filter"></i> Extracted Data</h3>
            <button class="btn btn-sm btn-outline" onclick="closeDataPanel()">
              <i class="fas fa-times"></i> Close
            </button>
          </div>
          <div class="extracted-data">
            <ul class="data-list" id="extractedList"></ul>
          </div>
        </div>
      </div>
      
      <div class="card">
        <div class="card-header">
          <h2 class="card-title"><i class="fas fa-tools"></i> Tools & Information</h2>
          <div class="tooltip" tabindex="0" aria-label="Info">
            <i class="fas fa-info-circle"></i>
            <span class="tooltiptext">View proxy status, history, and app information</span>
          </div>
        </div>
        
        <div class="tabs">
          <div class="tab active" onclick="switchTab('proxies')" tabindex="0" aria-label="Proxy Status">Proxy Status</div>
          <div class="tab" onclick="switchTab('history')" tabindex="0" aria-label="Request History">Request History</div>
          <div class="tab" onclick="switchTab('info')" tabindex="0" aria-label="Information">Information</div>
        </div>
        
        <div id="proxies" class="tab-content active">
          <h3><i class="fas fa-server"></i> Proxy Servers</h3>
          <p>Current proxy rotation status:</p>
          <div class="proxy-status" id="proxyStatus"></div>
          
          <div class="syntax-info">
            <p><i class="fas fa-lightbulb"></i> <strong>Tip:</strong> Use the Advanced Bypass button to rotate through proxy servers when encountering restrictions.</p>
          </div>
        </div>
        
        <div id="history" class="tab-content">
          <h3><i class="fas fa-history"></i> Request History</h3>
          <button class="btn btn-sm btn-outline" onclick="clearHistory()">
            <i class="fas fa-trash"></i> Clear History
          </button>
          <div class="history-panel" id="historyPanel"></div>
        </div>
        
        <div id="info" class="tab-content">
          <h3><i class="fas fa-info-circle"></i> About SourcePeek+ Pro</h3>
          <p>SourcePeek+ Pro is an advanced tool for viewing website source code, designed to bypass common restrictions and access controls.</p>
          
          <h4>Keyboard Shortcuts:</h4>
          <ul>
            <li><span class="key-shortcut">Ctrl</span> + <span class="key-shortcut">Enter</span> - Fetch source code</li>
            <li><span class="key-shortcut">Ctrl</span> + <span class="key-shortcut">B</span> - Activate bypass</li>
            <li><span class="key-shortcut">Ctrl</span> + <span class="key-shortcut">C</span> - Copy source to clipboard</li>
            <li><span class="key-shortcut">Ctrl</span> + <span class="key-shortcut">D</span> - Download source</li>
            <li><span class="key-shortcut">Ctrl</span> + <span class="key-shortcut">F</span> - Format code</li>
            <li><span class="key-shortcut">Ctrl</span> + <span class="key-shortcut">M</span> - Minify code</li>
            <li><span class="key-shortcut">Ctrl</span> + <span class="key-shortcut">E</span> - Extract data</li>
          </ul>
          
          <h4>New Features:</h4>
          <ul>
            <li>Light/Dark Mode Toggle</li>
            <li>Data Extraction (Links, Images, Scripts)</li>
            <li>Code Minification</li>
            <li>Improved Proxy Management</li>
            <li>Enhanced Error Handling</li>
          </ul>
        </div>
      </div>
    </main>
    
    <div class="disclaimer">
      <strong><i class="fas fa-exclamation-triangle"></i> Legal & Ethical Disclaimer:</strong> This tool is for educational and research purposes only. Use it responsibly and respect:
      <ul>
        <li>Website terms of service and robots.txt files</li>
        <li>Copyright laws and intellectual property rights</li>
        <li>Privacy regulations (GDPR, CCPA, etc.)</li>
      </ul>
      <p>Some websites employ advanced protections against scraping. Repeated bypass attempts may violate computer fraud laws in some jurisdictions.</p>
    </div>
    
    <footer>
      <p>
        SourcePeek+ Pro v3.0 &copy; 2025 | MIT License | Created with <i class="fas fa-heart" style="color: var(--danger);"></i> for developers
      </p>
    </footer>
  </div>

  <script>
    // Initialize highlight.js
    hljs.highlightAll();
    
    // Enhanced proxy list
    const proxies = [
      { url: 'https://corsproxy.io/?', name: 'CorsProxy.io', status: 'unknown' },
      { url: 'https://api.codetabs.com/v1/proxy/?quest=', name: 'CodeTabs', status: 'unknown' },
      { url: 'https://cors-anywhere.herokuapp.com/', name: 'Cors Anywhere', status: 'unknown' },
      { url: 'https://thingproxy.freeboard.io/fetch/', name: 'ThingProxy', status: 'unknown' },
      { url: 'https://yacdn.org/proxy/', name: 'Yacdn', status: 'unknown' },
      { url: 'https://api.allorigins.win/raw?url=', name: 'AllOrigins', status: 'unknown' },
      { url: 'https://cors.bridged.cc/', name: 'Bridged.cc', status: 'unknown' }
    ];

    // State variables
    let currentProxyIndex = 0;
    let bypassAttempts = 0;
    const maxBypassAttempts = 7;
    let requestCount = 0;
    let successCount = 0;
    let bypassCount = 0;
    let requestHistory = [];
    let currentSource = '';
    
    // DOM elements
    const outputElement = document.getElementById('output');
    const statusElement = document.getElementById('status');
    const errorContainer = document.getElementById('errorContainer');
    const loadingElement = document.getElementById('loading');
    const proxyStatusElement = document.getElementById('proxyStatus');
    const historyPanel = document.getElementById('historyPanel');
    const requestCountElement = document.getElementById('requestCount');
    const successCountElement = document.getElementById('successCount');
    const bypassCountElement = document.getElementById('bypassCount');
    const themeToggle = document.getElementById('themeToggle');
    const dataExtractionPanel = document.getElementById('dataExtraction');
    const extractedList = document.getElementById('extractedList');
    
    // Initialize the app
    function init() {
      renderProxyStatus();
      loadHistory();
      setupEventListeners();
      loadThemePreference();
      
      // Check proxies on startup
      setTimeout(checkProxies, 2000);
    }
    
    // Set up event listeners
    function setupEventListeners() {
      document.getElementById('urlInput').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
          getSource();
        }
      });
      
      document.addEventListener('keydown', function(e) {
        if (e.ctrlKey) {
          switch(e.key) {
            case 'Enter':
              getSource();
              e.preventDefault();
              break;
            case 'b':
              tryBypassMethods();
              e.preventDefault();
              break;
            case 'c':
              copySource();
              e.preventDefault();
              break;
            case 'd':
              downloadSource();
              e.preventDefault();
              break;
            case 'f':
              beautifyCode();
              e.preventDefault();
              break;
            case 'm':
              minifyCode();
              e.preventDefault();
              break;
            case 'e':
              extractData();
              e.preventDefault();
              break;
          }
        }
      });
      
      // Theme toggle
      themeToggle.addEventListener('click', toggleTheme);
    }
    
    // Toggle light/dark theme
    function toggleTheme() {
      document.body.classList.toggle('light-mode');
      // Save preference
      localStorage.setItem('sourcepeekTheme', document.body.classList.contains('light-mode') ? 'light' : 'dark');
      // Re-highlight code for theme change
      if (currentSource) {
        outputElement.textContent = currentSource;
        hljs.highlightElement(outputElement);
      }
    }
    
    // Load theme preference
    function loadThemePreference() {
      const theme = localStorage.getItem('sourcepeekTheme');
      if (theme === 'light') {
        document.body.classList.add('light-mode');
      }
    }
    
    // Render proxy status
    function renderProxyStatus() {
      proxyStatusElement.innerHTML = '';
      proxies.forEach((proxy, index) => {
        const proxyElement = document.createElement('div');
        proxyElement.className = `proxy-tag ${proxy.status}`;
        proxyElement.innerHTML = `
          <i class="fas fa-${proxy.status === 'active' ? 'check-circle' : proxy.status === 'inactive' ? 'times-circle' : 'question-circle'}"></i>
          ${proxy.name}
        `;
        proxyStatusElement.appendChild(proxyElement);
      });
    }
    
    // Load request history
    function loadHistory() {
      const savedHistory = localStorage.getItem('sourcepeekHistory');
      if (savedHistory) {
        requestHistory = JSON.parse(savedHistory);
        renderHistory();
      }
    }
    
    // Save request history
    function saveHistory() {
      localStorage.setItem('sourcepeekHistory', JSON.stringify(requestHistory));
    }
    
    // Clear history
    function clearHistory() {
      requestHistory = [];
      saveHistory();
      renderHistory();
      updateStatus('History cleared');
    }
    
    // Render history
    function renderHistory() {
      historyPanel.innerHTML = '';
      
      if (requestHistory.length === 0) {
        historyPanel.innerHTML = '<p class="text-muted" style="padding:10px">No request history yet</p>';
        return;
      }
      
      // Show only the last 10 items
      const recentHistory = requestHistory.slice(-10).reverse();
      
      recentHistory.forEach(item => {
        const historyItem = document.createElement('div');
        historyItem.className = 'history-item';
        historyItem.innerHTML = `
          <div class="url">${truncate(item.url, 40)}</div>
          <div class="time">${new Date(item.timestamp).toLocaleTimeString()}</div>
        `;
        
        historyItem.addEventListener('click', () => {
          document.getElementById('urlInput').value = item.url;
          getSource();
        });
        
        historyPanel.appendChild(historyItem);
      });
    }
    
    // Helper to truncate long URLs
    function truncate(str, max) {
      return str.length > max ? str.substring(0, max) + '...' : str;
    }
    
    // Add to history
    function addToHistory(url) {
      // Check if URL already exists in history
      if (!requestHistory.some(item => item.url === url)) {
        requestHistory.push({
          url: url,
          timestamp: Date.now()
        });
        saveHistory();
        renderHistory();
      }
    }
    
    // Update counters
    function updateCounters() {
      requestCountElement.textContent = requestCount;
      successCountElement.textContent = successCount;
      bypassCountElement.textContent = bypassCount;
    }
    
    // Show status message
    function updateStatus(message, isError = false) {
      statusElement.textContent = message;
      statusElement.style.display = 'block';
      statusElement.style.borderLeftColor = isError ? 'var(--danger)' : 'var(--primary)';
    }
    
    // Show error message
    function showError(message) {
      errorContainer.innerHTML = `
        <div>${message}</div>
        <button class="btn btn-sm btn-outline" style="margin-top:10px" onclick="retryFetch()">
          <i class="fas fa-redo"></i> Retry
        </button>
      `;
      errorContainer.style.display = 'block';
    }
    
    // Hide error message
    function hideError() {
      errorContainer.style.display = 'none';
    }
    
    // Show loading
    function showLoading() {
      loadingElement.style.display = 'flex';
    }
    
    // Hide loading
    function hideLoading() {
      loadingElement.style.display = 'none';
    }
    
    // Switch tabs
    function switchTab(tabId) {
      // Hide all tab contents
      document.querySelectorAll('.tab-content').forEach(tab => {
        tab.classList.remove('active');
      });
      
      // Deactivate all tabs
      document.querySelectorAll('.tab').forEach(tab => {
        tab.classList.remove('active');
      });
      
      // Activate selected tab
      document.getElementById(tabId).classList.add('active');
      
      // Activate tab button
      document.querySelectorAll('.tab').forEach(tab => {
        if (tab.textContent.toLowerCase().includes(tabId)) {
          tab.classList.add('active');
        }
      });
    }
    
    // Main function to get source code
    async function getSource() {
      const urlInput = document.getElementById('urlInput');
      const url = urlInput.value.trim();

      // Hide previous outputs
      outputElement.style.display = 'none';
      hideError();
      dataExtractionPanel.style.display = 'none';

      // Validate URL
      if (!url) {
        showError('Please enter a valid URL.');
        return;
      }

      if (!url.startsWith('http')) {
        showError('Please include http:// or https:// in the URL');
        return;
      }

      // Add to history
      addToHistory(url);

      // Reset bypass attempts for new fetch
      bypassAttempts = 0;

      // Show loading
      showLoading();
      updateStatus('Connecting to website...');

      // Increment request count
      requestCount++;
      updateCounters();

      try {
        // Attempt to fetch the URL directly first
        const response = await fetchWithHeaders(url);

        if (!response.ok) {
          if (response.status === 403 || response.status === 429) {
            throw new Error(`Access denied (HTTP ${response.status}). The website may have protections in place.`);
          } else {
            throw new Error(`HTTP error! Status: ${response.status}`);
          }
        }

        // Get the response text
        const source = await response.text();

        // Update the output
        outputElement.textContent = source;
        outputElement.style.display = 'block';
        currentSource = source;

        // Highlight syntax
        hljs.highlightElement(outputElement);

        // Update status
        updateStatus(`Successfully fetched source code from ${url}`);
        successCount++;
        updateCounters();
      } catch (error) {
        handleFetchError(error, url);
      } finally {
        hideLoading();
      }
    }
    
    // Fetch with headers
    async function fetchWithHeaders(url, proxyUrl = null) {
      const targetUrl = proxyUrl ? proxyUrl + encodeURIComponent(url) : url;
      
      const headers = {
        'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36',
        'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8',
        'Accept-Language': 'en-US,en;q=0.5',
        'Referer': 'https://www.google.com/',
        'DNT': '1'
      };
      
      return await fetch(targetUrl, {
        headers: headers,
        mode: 'cors'
      });
    }
    
    // Handle fetch errors
    function handleFetchError(error, url) {
      console.error('Fetch error:', error);
      
      let errorMessage = error.message;
      
      if (errorMessage.includes('Failed to fetch')) {
        errorMessage = 'Network error: Could not connect to the website. Check your connection or try a proxy.';
      } else if (errorMessage.includes('CORS')) {
        errorMessage = 'CORS error: The website blocked this request due to cross-origin restrictions.';
      }
      
      showError(errorMessage);
      outputElement.textContent = `Error: ${errorMessage}\n\nURL: ${url}`;
      outputElement.style.display = 'block';
      currentSource = '';
    }
    
    // Retry fetch
    function retryFetch() {
      hideError();
      getSource();
    }
    
    // Try bypass methods
    async function tryBypassMethods() {
      const url = document.getElementById('urlInput').value.trim();

      if (!url) {
        showError('Please enter a URL first');
        return;
      }

      bypassAttempts++;

      if (bypassAttempts > maxBypassAttempts) {
        // Check if all proxies are inactive
        const allInactive = proxies.every(p => p.status === 'inactive');
        if (allInactive) {
          showError('All proxies are currently inactive. Please try again later or check your network.');
        } else {
          showError(`Maximum bypass attempts (${maxBypassAttempts}) reached. Website may have strong protections.`);
        }
        return;
      }

      // Show loading
      showLoading();
      updateStatus(`Attempting bypass method ${bypassAttempts} of ${maxBypassAttempts}...`);

      try {
        // Get the next proxy
        let attempts = 0;
        let proxy, response, source;
        let found = false;
        while (attempts < proxies.length && !found) {
          proxy = proxies[currentProxyIndex];
          try {
            response = await fetchWithHeaders(url, proxy.url);
            if (response.ok) {
              source = await response.text();
              if (source) {
                found = true;
                break;
              }
            }
            // Mark proxy as inactive if failed
            proxy.status = 'inactive';
            renderProxyStatus();
          } catch (e) {
            proxy.status = 'inactive';
            renderProxyStatus();
          }
          // Rotate to next proxy
          currentProxyIndex = (currentProxyIndex + 1) % proxies.length;
          attempts++;
        }

        if (!found) {
          throw new Error('All proxies failed or returned empty content.');
        }

        // Update the output
        outputElement.textContent = source;
        outputElement.style.display = 'block';
        currentSource = source;

        // Highlight syntax
        hljs.highlightElement(outputElement);

        // Update status
        updateStatus(`Success! Used proxy: ${proxy.name}`);
        bypassCount++;
        updateCounters();

        // Mark proxy as active
        proxy.status = 'active';
        renderProxyStatus();
      } catch (error) {
        handleFetchError(error, url);
      } finally {
        hideLoading();
      }
    }

    // Check all proxies in parallel (debounced)
    async function checkProxies() {
      if (proxyCheckTimeout) {
        clearTimeout(proxyCheckTimeout);
      }
      proxyCheckTimeout = setTimeout(async () => {
        showLoading();
        updateStatus('Checking proxy servers...');

        const testUrl = 'https://example.com';

        const proxyChecks = proxies.map(async (proxy, index) => {
          try {
            const response = await fetchWithHeaders(testUrl, proxy.url);
            if (response.ok) {
              proxy.status = 'active';
            } else {
              proxy.status = 'inactive';
            }
          } catch (error) {
            proxy.status = 'inactive';
          }
          renderProxyStatus();
        });

        await Promise.all(proxyChecks);

        updateStatus('Proxy check completed');
        hideLoading();
      }, 300);
    }

    // Copy source to clipboard
    async function copySource() {
      if (!currentSource) {
        showError('No source code to copy');
        return;
      }
      
      try {
        await navigator.clipboard.writeText(outputElement.textContent);
        updateStatus('Source code copied to clipboard');
      } catch (err) {
        showError('Failed to copy: ' + err);
      }
    }
    
    // Download source code
    function downloadSource() {
      if (!currentSource) {
        showError('No source code to download');
        return;
      }
      
      const blob = new Blob([outputElement.textContent], { type: 'text/html' });
      const url = URL.createObjectURL(blob);
      
      const a = document.createElement('a');
      a.href = url;
      a.download = 'source_code.html';
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
      
      updateStatus('Source code downloaded');
    }
    
    // Beautify code
    function beautifyCode() {
      if (!currentSource) {
        showError('No source code to format');
        return;
      }
      
      try {
        const formatted = html_beautify(currentSource, {
          indent_size: 2,
          indent_char: ' ',
          max_preserve_newlines: 5,
          preserve_newlines: true,
          indent_scripts: 'normal'
        });
        
        outputElement.textContent = formatted;
        hljs.highlightElement(outputElement);
        currentSource = formatted;
        
        updateStatus('Source code formatted');
      } catch (e) {
        showError('Error formatting code: ' + e.message);
      }
    }
    
    // Minify code
    function minifyCode() {
      if (!currentSource) {
        showError('No source code to minify');
        return;
      }
      
      try {
        // Simple minification (remove extra whitespace)
        const minified = currentSource
          .replace(/\s+/g, ' ')
          .replace(/>\s+</g, '><')
          .trim();
        
        outputElement.textContent = minified;
        hljs.highlightElement(outputElement);
        currentSource = minified;
        
        updateStatus('Source code minified');
      } catch (e) {
        showError('Error minifying code: ' + e.message);
      }
    }
    
    // Extract data from source
    function extractData() {
      if (!currentSource) {
        showError('No source code to analyze');
        return;
      }
      
      dataExtractionPanel.style.display = 'block';
      extractedList.innerHTML = '';
      
      // Extract links
      const linkMatches = currentSource.match(/<a\s+(?:[^>]*?\s+)?href=(["'])(.*?)\1/gi) || [];
      const links = [...new Set(linkMatches.map(link => 
        link.match(/href=(["'])(.*?)\1/i)[2]
      ))].filter(link => link.startsWith('http'));
      
      // Extract images
      const imgMatches = currentSource.match(/<img\s+(?:[^>]*?\s+)?src=(["'])(.*?)\1/gi) || [];
      const images = [...new Set(imgMatches.map(img => 
        img.match(/src=(["'])(.*?)\1/i)[2]
      ))];
      
      // Extract scripts
      const scriptMatches = currentSource.match(/<script\s+(?:[^>]*?\s+)?src=(["'])(.*?)\1/gi) || [];
      const scripts = [...new Set(scriptMatches.map(script => 
        script.match(/src=(["'])(.*?)\1/i)[2]
      ))];
      
      // Display results
      if (links.length > 0) {
        const li = document.createElement('li');
        li.innerHTML = `<strong>Links (${links.length}):</strong>`;
        extractedList.appendChild(li);
        
        links.forEach(link => {
          const li = document.createElement('li');
          li.innerHTML = `<a href="${link}" target="_blank">${link}</a>`;
          extractedList.appendChild(li);
        });
      }
      
      if (images.length > 0) {
        const li = document.createElement('li');
        li.innerHTML = `<strong>Images (${images.length}):</strong>`;
        extractedList.appendChild(li);
        
        images.forEach(img => {
          const li = document.createElement('li');
          li.innerHTML = `<a href="${img}" target="_blank">${img}</a>`;
          extractedList.appendChild(li);
        });
      }
      
      if (scripts.length > 0) {
        const li = document.createElement('li');
        li.innerHTML = `<strong>Scripts (${scripts.length}):</strong>`;
        extractedList.appendChild(li);
        
        scripts.forEach(script => {
          const li = document.createElement('li');
          li.innerHTML = `<a href="${script}" target="_blank">${script}</a>`;
          extractedList.appendChild(li);
        });
      }
      
      if (links.length === 0 && images.length === 0 && scripts.length === 0) {
        extractedList.innerHTML = '<li>No links, images, or scripts found</li>';
      }
    }
    
    // Close data panel
    function closeDataPanel() {
      dataExtractionPanel.style.display = 'none';
    }
    
    // Clear output
    function clearOutput() {
      outputElement.textContent = '';
      outputElement.style.display = 'none';
      hideError();
      updateStatus('Output cleared');
      bypassAttempts = 0;
      currentSource = '';
      dataExtractionPanel.style.display = 'none';
    }
    
    // Autofocus and select input on focus for quick editing
    document.addEventListener('DOMContentLoaded', function() {
      const urlInput = document.getElementById('urlInput');
      urlInput.focus();
      urlInput.addEventListener('focus', function() {
        urlInput.select();
      });
    });

    // Debounce for proxy checks
    let proxyCheckTimeout = null;

    // Initialize the app
    function init() {
      renderProxyStatus();
      loadHistory();
      setupEventListeners();
      loadThemePreference();
      setTimeout(checkProxies, 2000);
    }

    // Set up event listeners
    function setupEventListeners() {
      document.getElementById('urlInput').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
          getSource();
        }
      });
      
      document.addEventListener('keydown', function(e) {
        if (e.ctrlKey) {
          switch(e.key) {
            case 'Enter':
              getSource();
              e.preventDefault();
              break;
            case 'b':
              tryBypassMethods();
              e.preventDefault();
              break;
            case 'c':
              copySource();
              e.preventDefault();
              break;
            case 'd':
              downloadSource();
              e.preventDefault();
              break;
            case 'f':
              beautifyCode();
              e.preventDefault();
              break;
            case 'm':
              minifyCode();
              e.preventDefault();
              break;
            case 'e':
              extractData();
              e.preventDefault();
              break;
          }
        }
      });
      
      // Theme toggle
      themeToggle.addEventListener('click', toggleTheme);
    }
    
    // Toggle light/dark theme
    function toggleTheme() {
      document.body.classList.toggle('light-mode');
      // Save preference
      localStorage.setItem('sourcepeekTheme', document.body.classList.contains('light-mode') ? 'light' : 'dark');
      // Re-highlight code for theme change
      if (currentSource) {
        outputElement.textContent = currentSource;
        hljs.highlightElement(outputElement);
      }
    }
    
    // Load theme preference
    function loadThemePreference() {
      const theme = localStorage.getItem('sourcepeekTheme');
      if (theme === 'light') {
        document.body.classList.add('light-mode');
      }
    }
    
    // Render proxy status
    function renderProxyStatus() {
      proxyStatusElement.innerHTML = '';
      proxies.forEach((proxy, index) => {
        const proxyElement = document.createElement('div');
        proxyElement.className = `proxy-tag ${proxy.status}`;
        proxyElement.innerHTML = `
          <i class="fas fa-${proxy.status === 'active' ? 'check-circle' : proxy.status === 'inactive' ? 'times-circle' : 'question-circle'}"></i>
          ${proxy.name}
        `;
        proxyStatusElement.appendChild(proxyElement);
      });
    }
    
    // Load request history
    function loadHistory() {
      const savedHistory = localStorage.getItem('sourcepeekHistory');
      if (savedHistory) {
        requestHistory = JSON.parse(savedHistory);
        renderHistory();
      }
    }
    
    // Save request history
    function saveHistory() {
      localStorage.setItem('sourcepeekHistory', JSON.stringify(requestHistory));
    }
    
    // Clear history
    function clearHistory() {
      requestHistory = [];
      saveHistory();
      renderHistory();
      updateStatus('History cleared');
    }
    
    // Render history
    function renderHistory() {
      historyPanel.innerHTML = '';
      
      if (requestHistory.length === 0) {
        historyPanel.innerHTML = '<p class="text-muted" style="padding:10px">No request history yet</p>';
        return;
      }
      
      // Show only the last 10 items
      const recentHistory = requestHistory.slice(-10).reverse();
      
      recentHistory.forEach(item => {
        const historyItem = document.createElement('div');
        historyItem.className = 'history-item';
        historyItem.innerHTML = `
          <div class="url">${truncate(item.url, 40)}</div>
          <div class="time">${new Date(item.timestamp).toLocaleTimeString()}</div>
        `;
        
        historyItem.addEventListener('click', () => {
          document.getElementById('urlInput').value = item.url;
          getSource();
        });
        
        historyPanel.appendChild(historyItem);
      });
    }
    
    // Helper to truncate long URLs
    function truncate(str, max) {
      return str.length > max ? str.substring(0, max) + '...' : str;
    }
    
    // Add to history
    function addToHistory(url) {
      // Check if URL already exists in history
      if (!requestHistory.some(item => item.url === url)) {
        requestHistory.push({
          url: url,
          timestamp: Date.now()
        });
        saveHistory();
        renderHistory();
      }
    }
    
    // Update counters
    function updateCounters() {
      requestCountElement.textContent = requestCount;
      successCountElement.textContent = successCount;
      bypassCountElement.textContent = bypassCount;
    }
    
    // Show status message
    function updateStatus(message, isError = false) {
      statusElement.textContent = message;
      statusElement.style.display = 'block';
      statusElement.style.borderLeftColor = isError ? 'var(--danger)' : 'var(--primary)';
    }
    
    // Show error message
    function showError(message) {
      errorContainer.innerHTML = `
        <div>${message}</div>
        <button class="btn btn-sm btn-outline" style="margin-top:10px" onclick="retryFetch()">
          <i class="fas fa-redo"></i> Retry
        </button>
      `;
      errorContainer.style.display = 'block';
    }
    
    // Hide error message
    function hideError() {
      errorContainer.style.display = 'none';
    }
    
    // Show loading
    function showLoading() {
      loadingElement.style.display = 'flex';
    }
    
    // Hide loading
    function hideLoading() {
      loadingElement.style.display = 'none';
    }
    
    // Switch tabs
    function switchTab(tabId) {
      // Hide all tab contents
      document.querySelectorAll('.tab-content').forEach(tab => {
        tab.classList.remove('active');
      });
      
      // Deactivate all tabs
      document.querySelectorAll('.tab').forEach(tab => {
        tab.classList.remove('active');
      });
      
      // Activate selected tab
      document.getElementById(tabId).classList.add('active');
      
      // Activate tab button
      document.querySelectorAll('.tab').forEach(tab => {
        if (tab.textContent.toLowerCase().includes(tabId)) {
          tab.classList.add('active');
        }
      });
    }
    
    // Main function to get source code
    async function getSource() {
      const urlInput = document.getElementById('urlInput');
      const url = urlInput.value.trim();

      // Hide previous outputs
      outputElement.style.display = 'none';
      hideError();
      dataExtractionPanel.style.display = 'none';

      // Validate URL
      if (!url) {
        showError('Please enter a valid URL.');
        return;
      }

      if (!url.startsWith('http')) {
        showError('Please include http:// or https:// in the URL');
        return;
      }

      // Add to history
      addToHistory(url);

      // Reset bypass attempts for new fetch
      bypassAttempts = 0;

      // Show loading
      showLoading();
      updateStatus('Connecting to website...');

      // Increment request count
      requestCount++;
      updateCounters();

      try {
        // Attempt to fetch the URL directly first
        const response = await fetchWithHeaders(url);

        if (!response.ok) {
          if (response.status === 403 || response.status === 429) {
            throw new Error(`Access denied (HTTP ${response.status}). The website may have protections in place.`);
          } else {
            throw new Error(`HTTP error! Status: ${response.status}`);
          }
        }

        // Get the response text
        const source = await response.text();

        // Update the output
        outputElement.textContent = source;
        outputElement.style.display = 'block';
        currentSource = source;

        // Highlight syntax
        hljs.highlightElement(outputElement);

        // Update status
        updateStatus(`Successfully fetched source code from ${url}`);
        successCount++;
        updateCounters();
      } catch (error) {
        handleFetchError(error, url);
      } finally {
        hideLoading();
      }
    }
    
    // Fetch with headers
    async function fetchWithHeaders(url, proxyUrl = null) {
      const targetUrl = proxyUrl ? proxyUrl + encodeURIComponent(url) : url;
      
      const headers = {
        'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36',
        'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8',
        'Accept-Language': 'en-US,en;q=0.5',
        'Referer': 'https://www.google.com/',
        'DNT': '1'
      };
      
      return await fetch(targetUrl, {
        headers: headers,
        mode: 'cors'
      });
    }
    
    // Handle fetch errors
    function handleFetchError(error, url) {
      console.error('Fetch error:', error);
      
      let errorMessage = error.message;
      
      if (errorMessage.includes('Failed to fetch')) {
        errorMessage = 'Network error: Could not connect to the website. Check your connection or try a proxy.';
      } else if (errorMessage.includes('CORS')) {
        errorMessage = 'CORS error: The website blocked this request due to cross-origin restrictions.';
      }
      
      showError(errorMessage);
      outputElement.textContent = `Error: ${errorMessage}\n\nURL: ${url}`;
      outputElement.style.display = 'block';
      currentSource = '';
    }
    
    // Retry fetch
    function retryFetch() {
      hideError();
      getSource();
    }
    
    // Try bypass methods
    async function tryBypassMethods() {
      const url = document.getElementById('urlInput').value.trim();

      if (!url) {
        showError('Please enter a URL first');
        return;
      }

      bypassAttempts++;

      if (bypassAttempts > maxBypassAttempts) {
        // Check if all proxies are inactive
        const allInactive = proxies.every(p => p.status === 'inactive');
        if (allInactive) {
          showError('All proxies are currently inactive. Please try again later or check your network.');
        } else {
          showError(`Maximum bypass attempts (${maxBypassAttempts}) reached. Website may have strong protections.`);
        }
        return;
      }

      // Show loading
      showLoading();
      updateStatus(`Attempting bypass method ${bypassAttempts} of ${maxBypassAttempts}...`);

      try {
        // Get the next proxy
        let attempts = 0;
        let proxy, response, source;
        let found = false;
        while (attempts < proxies.length && !found) {
          proxy = proxies[currentProxyIndex];
          try {
            response = await fetchWithHeaders(url, proxy.url);
            if (response.ok) {
              source = await response.text();
              if (source) {
                found = true;
                break;
              }
            }
            // Mark proxy as inactive if failed
            proxy.status = 'inactive';
            renderProxyStatus();
          } catch (e) {
            proxy.status = 'inactive';
            renderProxyStatus();
          }
          // Rotate to next proxy
          currentProxyIndex = (currentProxyIndex + 1) % proxies.length;
          attempts++;
        }

        if (!found) {
          throw new Error('All proxies failed or returned empty content.');
        }

        // Update the output
        outputElement.textContent = source;
        outputElement.style.display = 'block';
        currentSource = source;

        // Highlight syntax
        hljs.highlightElement(outputElement);

        // Update status
        updateStatus(`Success! Used proxy: ${proxy.name}`);
        bypassCount++;
        updateCounters();

        // Mark proxy as active
        proxy.status = 'active';
        renderProxyStatus();
      } catch (error) {
        handleFetchError(error, url);
      } finally {
        hideLoading();
      }
    }

    // Check all proxies in parallel (debounced)
    async function checkProxies() {
      if (proxyCheckTimeout) {
        clearTimeout(proxyCheckTimeout);
      }
      proxyCheckTimeout = setTimeout(async () => {
        showLoading();
        updateStatus('Checking proxy servers...');

        const testUrl = 'https://example.com';

        const proxyChecks = proxies.map(async (proxy, index) => {
          try {
            const response = await fetchWithHeaders(testUrl, proxy.url);
            if (response.ok) {
              proxy.status = 'active';
            } else {
              proxy.status = 'inactive';
            }
          } catch (error) {
            proxy.status = 'inactive';
          }
          renderProxyStatus();
        });

        await Promise.all(proxyChecks);

        updateStatus('Proxy check completed');
        hideLoading();
      }, 300);
    }

    // Copy source to clipboard
    async function copySource() {
      if (!currentSource) {
        showError('No source code to copy');
        return;
      }
      
      try {
        await navigator.clipboard.writeText(outputElement.textContent);
        updateStatus('Source code copied to clipboard');
      } catch (err) {
        showError('Failed to copy: ' + err);
      }
    }
    
    // Download source code
    function downloadSource() {
      if (!currentSource) {
        showError('No source code to download');
        return;
      }
      
      const blob = new Blob([outputElement.textContent], { type: 'text/html' });
      const url = URL.createObjectURL(blob);
      
      const a = document.createElement('a');
      a.href = url;
      a.download = 'source_code.html';
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
      
      updateStatus('Source code downloaded');
    }
    
    // Beautify code
    function beautifyCode() {
      if (!currentSource) {
        showError('No source code to format');
        return;
      }
      
      try {
        const formatted = html_beautify(currentSource, {
          indent_size: 2,
          indent_char: ' ',
          max_preserve_newlines: 5,
          preserve_newlines: true,
          indent_scripts: 'normal'
        });
        
        outputElement.textContent = formatted;
        hljs.highlightElement(outputElement);
        currentSource = formatted;
        
        updateStatus('Source code formatted');
      } catch (e) {
        showError('Error formatting code: ' + e.message);
      }
    }
    
    // Minify code
    function minifyCode() {
      if (!currentSource) {
        showError('No source code to minify');
        return;
      }
      
      try {
        // Simple minification (remove extra whitespace)
        const minified = currentSource
          .replace(/\s+/g, ' ')
          .replace(/>\s+</g, '><')
          .trim();
        
        outputElement.textContent = minified;
        hljs.highlightElement(outputElement);
        currentSource = minified;
        
        updateStatus('Source code minified');
      } catch (e) {
        showError('Error minifying code: ' + e.message);
      }
    }
    
    // Extract data from source
    function extractData() {
      if (!currentSource) {
        showError('No source code to analyze');
        return;
      }
      
      dataExtractionPanel.style.display = 'block';
      extractedList.innerHTML = '';
      
      // Extract links
      const linkMatches = currentSource.match(/<a\s+(?:[^>]*?\s+)?href=(["'])(.*?)\1/gi) || [];
      const links = [...new Set(linkMatches.map(link => 
        link.match(/href=(["'])(.*?)\1/i)[2]
      ))].filter(link => link.startsWith('http'));
      
      // Extract images
      const imgMatches = currentSource.match(/<img\s+(?:[^>]*?\s+)?src=(["'])(.*?)\1/gi) || [];
      const images = [...new Set(imgMatches.map(img => 
        img.match(/src=(["'])(.*?)\1/i)[2]
      ))];
      
      // Extract scripts
      const scriptMatches = currentSource.match(/<script\s+(?:[^>]*?\s+)?src=(["'])(.*?)\1/gi) || [];
      const scripts = [...new Set(scriptMatches.map(script => 
        script.match(/src=(["'])(.*?)\1/i)[2]
      ))];
      
      // Display results
      if (links.length > 0) {
        const li = document.createElement('li');
        li.innerHTML = `<strong>Links (${links.length}):</strong>`;
        extractedList.appendChild(li);
        
        links.forEach(link => {
          const li = document.createElement('li');
          li.innerHTML = `<a href="${link}" target="_blank">${link}</a>`;
          extractedList.appendChild(li);
        });
      }
      
      if (images.length > 0) {
        const li = document.createElement('li');
        li.innerHTML = `<strong>Images (${images.length}):</strong>`;
        extractedList.appendChild(li);
        
        images.forEach(img => {
          const li = document.createElement('li');
          li.innerHTML = `<a href="${img}" target="_blank">${img}</a>`;
          extractedList.appendChild(li);
        });
      }
      
      if (scripts.length > 0) {
        const li = document.createElement('li');
        li.innerHTML = `<strong>Scripts (${scripts.length}):</strong>`;
        extractedList.appendChild(li);
        
        scripts.forEach(script => {
          const li = document.createElement('li');
          li.innerHTML = `<a href="${script}" target="_blank">${script}</a>`;
          extractedList.appendChild(li);
        });
      }
      
      if (links.length === 0 && images.length === 0 && scripts.length === 0) {
        extractedList.innerHTML = '<li>No links, images, or scripts found</li>';
      }
    }
    
    // Close data panel
    function closeDataPanel() {
      dataExtractionPanel.style.display = 'none';
    }
    
    // Clear output
    function clearOutput() {
      outputElement.textContent = '';
      outputElement.style.display = 'none';
      hideError();
      updateStatus('Output cleared');
      bypassAttempts = 0;
      currentSource = '';
      dataExtractionPanel.style.display = 'none';
    }
    
    // Initialize the app when DOM is loaded
    document.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>
